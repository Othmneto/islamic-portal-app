<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Day View Test</title>
    <link rel="stylesheet" href="css/calendar-enhanced.css">
    <style>
        body {
            margin: 0;
            padding: 20px;
            background: #1f2937;
            color: white;
            font-family: Arial, sans-serif;
        }
        .test-container {
            max-width: 1200px;
            margin: 0 auto;
        }
        .day-view {
            display: grid;
            grid-template-columns: 80px 1fr;
            gap: 1px;
            background: #374151;
            border-radius: 8px;
            overflow: hidden;
        }
        .day-header {
            display: grid;
            grid-template-columns: 80px 1fr;
            gap: 1px;
            background: #374151;
            border-radius: 8px 8px 0 0;
            overflow: hidden;
        }
        .day-grid {
            display: flex;
            flex-direction: column;
            background: #1f2937;
            border-radius: 0 0 8px 8px;
            overflow: hidden;
        }
        .test-controls {
            margin-bottom: 20px;
            padding: 15px;
            background: #374151;
            border-radius: 8px;
        }
        .test-controls button {
            background: #3b82f6;
            color: white;
            border: none;
            padding: 8px 16px;
            margin: 5px;
            border-radius: 4px;
            cursor: pointer;
        }
        .test-controls button:hover {
            background: #2563eb;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>Day View Test</h1>
        <p>Testing the day view with real calendar events data.</p>
        
        <div class="test-controls">
            <button onclick="addTestEvents()">Add Test Events</button>
            <button onclick="clearEvents()">Clear Events</button>
            <button onclick="renderDayView()">Refresh Day View</button>
            <button onclick="showEventData()">Show Event Data</button>
        </div>
        
        <div class="day-view">
            <div class="day-header">
                <div class="time-column">Time</div>
                <div class="day-column">
                    <div class="day-name">Monday</div>
                    <div class="day-number">13</div>
                    <div class="day-month">January 2025</div>
                </div>
            </div>
            <div class="day-grid" id="day-grid">
                <!-- Time slots will be generated here -->
            </div>
        </div>
        
        <div id="event-data" style="margin-top: 20px; padding: 15px; background: #374151; border-radius: 8px;">
            <h3>Event Data:</h3>
            <pre id="event-data-content">No events loaded yet</pre>
        </div>
    </div>

    <script>
        // Simulate the calendar events array
        let calendarEvents = [];
        let currentDate = new Date();
        
        // Simulate the day view rendering
        function renderDayView() {
            const dayGrid = document.getElementById('day-grid');
            if (!dayGrid) return;
            
            dayGrid.innerHTML = '';
            
            console.log('Rendering day view for:', currentDate);
            console.log('Total calendar events:', calendarEvents.length);
            
            // Create time slots
            for (let hour = 0; hour < 24; hour++) {
                const timeSlot = document.createElement('div');
                timeSlot.className = 'time-slot';
                const label = `${hour.toString().padStart(2, '0')}:00`;
                timeSlot.innerHTML = `
                    <div class="time-label">${label}</div>
                    <div class="day-slot" data-hour="${hour}"></div>
                `;
                dayGrid.appendChild(timeSlot);
            }
            
            addEventsToDayView();
        }
        
        function addEventsToDayView() {
            console.log('Adding events to day view');
            
            const dayEvents = calendarEvents.filter(event => {
                const eventDate = new Date(event.startDate || event.start);
                return eventDate.toDateString() === currentDate.toDateString();
            });
            
            console.log('Day events found:', dayEvents.length);
            console.log('Day events:', dayEvents);
            
            dayEvents.forEach(event => {
                const eventDate = new Date(event.startDate || event.start);
                const hour = eventDate.getHours();
                const endHour = event.endDate ? new Date(event.endDate).getHours() : hour + 1;
                
                console.log('Processing day event:', event.title, 'Hour:', hour, 'End Hour:', endHour);
                
                const daySlot = document.querySelector(`.day-slot[data-hour="${hour}"]`);
                if (daySlot) {
                    const eventElement = document.createElement('div');
                    eventElement.className = 'day-event';
                    eventElement.innerHTML = `
                        <div class="event-title">${event.title || 'Event'}</div>
                        <div class="event-time">${formatTime(eventDate)}${event.endDate ? ' - ' + formatTime(new Date(event.endDate)) : ''}</div>
                        <div class="event-category">${event.category || ''}</div>
                    `;
                    eventElement.style.backgroundColor = event.color || '#3b82f6';
                    eventElement.style.color = 'white';
                    eventElement.style.padding = '8px';
                    eventElement.style.margin = '2px';
                    eventElement.style.borderRadius = '4px';
                    eventElement.style.fontSize = '0.8rem';
                    eventElement.style.cursor = 'pointer';
                    eventElement.style.position = 'relative';
                    eventElement.style.zIndex = '10';
                    
                    // Calculate height for multi-hour events
                    const duration = endHour - hour;
                    if (duration > 1) {
                        eventElement.style.height = `${(duration * 60) - 4}px`;
                        eventElement.style.position = 'absolute';
                        eventElement.style.top = '2px';
                        eventElement.style.left = '2px';
                        eventElement.style.right = '2px';
                    }
                    
                    // Add click handler
                    eventElement.addEventListener('click', (e) => {
                        e.stopPropagation();
                        console.log('Day event clicked:', event.title);
                        alert(`Event: ${event.title}\nTime: ${eventDate.toLocaleString()}`);
                    });
                    
                    daySlot.appendChild(eventElement);
                    console.log('Added day event to slot:', event.title);
                } else {
                    console.log('Could not find day slot for hour:', hour);
                }
            });
        }
        
        function formatTime(date) {
            return date.toLocaleTimeString('en-US', { 
                hour: '2-digit', 
                minute: '2-digit',
                hour12: false 
            });
        }
        
        function addTestEvents() {
            const today = new Date();
            const testEvents = [
                {
                    id: 'day-test-1',
                    title: 'Morning Standup',
                    startDate: new Date(today.getFullYear(), today.getMonth(), today.getDate(), 9, 0),
                    endDate: new Date(today.getFullYear(), today.getMonth(), today.getDate(), 9, 30),
                    color: '#3b82f6',
                    category: 'work'
                },
                {
                    id: 'day-test-2',
                    title: 'Client Meeting',
                    startDate: new Date(today.getFullYear(), today.getMonth(), today.getDate(), 11, 0),
                    endDate: new Date(today.getFullYear(), today.getMonth(), today.getDate(), 12, 0),
                    color: '#10b981',
                    category: 'meeting'
                },
                {
                    id: 'day-test-3',
                    title: 'Lunch Break',
                    startDate: new Date(today.getFullYear(), today.getMonth(), today.getDate(), 12, 30),
                    endDate: new Date(today.getFullYear(), today.getMonth(), today.getDate(), 13, 30),
                    color: '#f59e0b',
                    category: 'break'
                },
                {
                    id: 'day-test-4',
                    title: 'Code Review',
                    startDate: new Date(today.getFullYear(), today.getMonth(), today.getDate(), 14, 0),
                    endDate: new Date(today.getFullYear(), today.getMonth(), today.getDate(), 15, 0),
                    color: '#ef4444',
                    category: 'development'
                },
                {
                    id: 'day-test-5',
                    title: 'Project Planning',
                    startDate: new Date(today.getFullYear(), today.getMonth(), today.getDate(), 15, 30),
                    endDate: new Date(today.getFullYear(), today.getMonth(), today.getDate(), 17, 0),
                    color: '#8b5cf6',
                    category: 'planning'
                }
            ];
            
            calendarEvents = testEvents;
            console.log('Added', testEvents.length, 'test events');
            renderDayView();
            showEventData();
        }
        
        function clearEvents() {
            calendarEvents = [];
            console.log('Cleared all events');
            renderDayView();
            showEventData();
        }
        
        function showEventData() {
            const eventDataContent = document.getElementById('event-data-content');
            eventDataContent.textContent = JSON.stringify(calendarEvents, null, 2);
        }
        
        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', () => {
            renderDayView();
            showEventData();
        });
    </script>
</body>
</html>
